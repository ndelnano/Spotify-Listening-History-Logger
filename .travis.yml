sudo: required
dist: xenial
language: python
python:
- '3.6'
services:
- mysql
env:
  global:
  - secure: nnswvWrevd1UmoWuqAYqbUPg75b/HXvM9k5kY0CMN/1k5qAk/9Ydiok5HEXa7BEryh29fmkPUcjaTcWifFdvSXs0lrvFZ5qAWRXYbXRSlyBMpnJbBNeI/90TwstW3p5+qddj+HeaEDlQy5Ku00uuOaKqPWUF2LIRS8yw1wbh2yXmE8sCjvbKq11Pu0jPdIi4BuGmbRyZ8B9MrumGPBrJUOQ61olmCuFGrhKMwddgFO4vDkfjk694YP8/ekDzFoUySz2cmSBDJhyWJ5UDXjlbvJa3hQBdMHBwXypmqH90D9xkKyi7xNUr5euBIUkNutBY6TeHAX5of6+lZnNXk2BtfCjBlfEdOpP1k/b9OIQJD6xJctKzbMNC5pslPt0u7V8Wqs2vN9XPX7jyCMsB3NWQbvpEVFkaFCrKdM0Azs8SZA5FXAIL81jtexWQv3nVhJ0A2P/o7PBj3GoSeLRKvXPytIwcoUKm2g7JBAJGktMSmd0sF9HhSK1gTkv2zOEvy3mMumMHYL0fSPqZEe+YWcp8dTquhf3i2Cxq0eZpbfh0vaufKGg9HPrS2udRMJizfMV/VhE2UsX7lq9MyBbHzjI4rUzOuUf966iFigpHCxhtr5Z9Mu/VnqaXlinOP111I09Dbnia/NFOmSkXuo6iaCrrYu3c7DBfieWKx9Hz3xipbUE=
  - secure: U9LWxV0zz2zk33op33ZCQMC0u7rath+7812N8WL/6bIpNv77ARb/VeP8NBqDqSoBi1nwvo/WHhCUIEUpKQn4yKIw/5CFCbdTlXppQYNUjS8//IdvaL9nfRkbxGIi1TUR4yWcAYhH6bzMUQQfjZMde1Oet6FzrTpBBg3rWhFRnu9Ju6ca35Nh97WiTAvuulO935grk9PCFxOMfck3vSeflO6MUwWL65pQgVlR+mLadkjzDsIqiS2Y4a00sBT68xppn3tMIEh3ke6c8rj5hnEmEfoY5METsMiQeVU6E8n+nRsQHCAgwizBLK1Q8gRbarIEhz8wM44cDTSz0vcMuqlJGA2QtCIB2i+OqySooNgDHO7A6Hf47013HmqzZ93HoBXMGgpL1NmZwFJzsSoOd9RjXZGreTy3i+tcSelQXLkFHwzfuaXKr8cnohamsxVpE9VRkize30pVN3OkxnX22FdJoSoy1kH3TI/VJ8Lzy8KSqmPFmxgYZpapIp+rGg2UcE08uLsu09YyCunGK0/Vh9n/U61AWz2dp74tlXu5ekx+ypxpr9rax3t/uFNLNobxXYiecs3M8MCV5zYnOFyPkCwBPjUPLGZ1k0J2MlYfhvGgrEhVEuvsj1fUkwIpjl43wTQhnse/C5Myd0amsF2g2gwreJ/lmEv55WdpnU8JOKvSxdA=
  - secure: xq+8uqr62MjbrgtUbPdCMNIhC1uYZcTfME+7bH/6tgfKVSVJsPrcCSIi6L09SYY2w2pg0aKJwYv6Dch3Q535MGr52EtQ7UwTjiH0r9WLQAuFat5RGrsq6dmexalsUAwhsymYlW2yGwIoOyQaCWswQIot0/z8lhscjZhaGFYxOvlkzQ/2+m/H5Cgzd8F73zcW2je7Ttp9cjMu5E7+WssbPtNoc3DTDWbB/fJjXmmFBKRj08LjWxaD1Im/7f/vPynO9Ap6D4WlR+JeV4XTBGOSIiNJbNdtNSk47EFVpT7i8upIcTqLt+6S3JK13weiU0RmSfBSQ2LpWOQxtfvgzwnKy8WaQDORpMqmw22Nue3dh9ZzhnmoCAHGuHaMREwalQmB4xamr1eht7lM51WK8HShuDBOcSeSYvXKKsSbfzehwonZAYExLVgATwSE9HFHrmyZeCug/+hvEhENRf6QoI+LEICTHw6obRR172Xh6MrhHvVYoNVqtEwkyZUxo0PweF/c3fCy1+VRK0lfpVJVqBgLRDAAgP8Dk9Tb8ErW8+UdMqa4bxwzozXb2Zot+vIvWcoEFKAcwJayAN8/r9X9LzWq63iYwh3zmJCfBzrWxuBGrjImRv60owo0rC7+GAY+Mxf1lS7eDFrDIbpZL4nm+35sj7Dly9Bz+uTcSR873EE9NTU=
  - secure: riMov07lyrd3SbizGtmaf9RF6wWQviaitrK5VGyDQoZZf3IhGTvyv+rVUfy/cshHWWFPeYj5dyPBVdSh2/F3GBL5hr0PpcGP3KwEUoi/r5ZsMK/EkWD3B073aeTOSPBBgf9Lw3/kTFkxZgikrhKsfORZoWLld1xDZmjxUgA1XgTDI0YYBLWm3vRESMtHnSHzredeg1Mzbggycrlqh7fmpgduaNb09bwoAaK9mdVkQYzGWPZB5QbypDkEXuu1ucGe+5RyIwCEjPhR+QVhSwhq1njbCsoG73R7usmJvvlrJMiQM6kqt8Jc5Np5SwZ5MnfaoLocvY+TlyKo/wrtXeYCLenq+0lX7fPuNn2tEm026xeTTknyDD3I2spj4Jv6kBDTunO3I4Wa2Uzh9/JwFOWzUrBg/b0eMphUD0wyQaKLSmyrqqps2V5Bu1Kpxszgc185m1IO6G53rxCL1uzQRtTd4OkzKNYun144BfWHPscR7Ai5vuWtc0rsGmrsOZQZ0iZBg0STKHnoUMP7sK5DJXhlUuCpqT8yLICBRHQlFr8jusuHKgNzYJMdR6D0ziGyHATiIgP3S2yqCEz0UI2OUA6UUzls8fQ9bNfiaHzxJ34Ya+Ya0ea0pz0CT5oQB5my2pnxBGkTDvO2zz9766NeMLqThWzmE9nlO5LW/1WL/8f/ooY=
  - secure: eBrCVWk1muyUTMZN5uPWVOCwfUC+xgVoPHVJvkPg78dcIhgv/UBXtypjq8p7OvNtdKX4XA+I2ItDnVIckp1TehzrLUiDRsML78Y6Wb1hxrkupMyw6DvtWnzfALs/fjnQhrhEJ8cAlYq/fhVAg0bjFkcJ/XEuHVSxSbifxH8/VnURz7AZlnW4TNuc0pdiju4df1Dqd0jGd3O2qWBwyMsb2vzvXW1nfbnvIWCcd5WMCNgtL8Px1PLRSCVfZFZRFi08i1/LSGh9UCEbT2V3YfnmTlytzxw4uGqapx0ou94s1xGLoAmq4f4XdgL6+DE9J0PjSxRJ7sLeaqRR1HiYbCM00/Z5bkgzCuMiWps9xrfboq84FKLMO18iYZBxy0ElxkZdux7GusSUSpdljIdI/KubOLMM+5IznsXfdl2UHD14iChUFr1xNUOHOJHtMBWwqEvZsuF3cD5gunqlmT7sv2kqT7PFV8wlrqXeVvC4D4mFwZDyxtzkmfGHNX5HYOjQxmrUzOO6+8D3FO4jGlth/KW37ZHa8rYoBrweC2dE2VjiZft1kVZoz5xt+3Gr4Nopx+iHlNIueraFvn4/YWkVst2HM3dEno9ClXRAKDru/hmI0vMf/hwsKbqpymKcMgg9zbDEW0ZJeESm+KlO9nHxS+biHeVeMCDevOq0NjnWwnvH5/U=
  - secure: M0aSwSubNiipF0pofebMHDb3dY3SAa6Ad8gdw1Ah2bvQYN3NKh0ts2J2o7tclzcWwYnIPNfBPTD1mFVP/C/OqYGQp1IzdujnHwjVMTRUeFhIEm865mZjoBkDr/GsDbEFdRrEtmzFDvgM+BjjDzwmVpjN+uXuYiI47tv5dgnAH5QQnLiu+gocOqyvv/oAzsEkI0hPLZ5pcgFH02d4MtgDhwxPehyHez1PERgLhWQERTaPDAsuiY4l1Pv0OT0X0kZObqAfuKD6iZg3nMqqJr+w5KZy2yNhPW6PFQwrXKABBWpt7z17C+UkDcu/gpUBlXnucpMIcJc+1xaN9rrH4wht8gIbwRYTrd2JIzFJ/zZME38Lft1ll01vryg23ECFz64IuW6p1FKdLnEPdhdUXe1W2ngcwZSeyL5YVTtpy+HOHBfu/Q75Le+VIvAH9iw0jMI9AL/ujEFsO4L+H/QZV6zRyJyB7gdAZBskRmqc6RV/zwQHzwudwbKUZws7O0Y2G9LzyyKqpMjWnUKw0nE79ac1BkAq6IO433Q25eF5Pp0XtiU55KrE4BoKtIDNX0FCvdRrsRADUbyunExJvduPl1u+L/hs6/RGRZzNB9ueLllmr4c3g1OwwIhqfZoc89xsWNRU8Qley8/KBNkKMElE9UrdhaiBiu4z0yL7QwdpXCOQbIM=
  - secure: ZLy42OQePqmC5KjWiW7MSAtjA9i/ksV0/VkASIbnAjcD9pOgfVVLjpcysY8G7uQ/k0o9QJEtOUtkm63r3k44OMDVCBrSt9hcM3H0FTd7psagJRyhhY1Z0G56RZtsDR80GD25AcKDoHrdFcb+kCaGBuuPKLNUqL/yuSF0E2Wp8TJ3hakHc4VLI880/Kh5WFQQV/KBQD6XeZ6OjTeBvXDZPMq4gsfvsVyvUcfs3Y+YLS2yvUG+54qe2G83jRmoUjXKx218Ot5BmLdngYW1YKPdm6UnyH4VqG4NKPXECtCeY/C5VO7neVzs4ZV493BTTI6Ob1ROC2a4BX9qLusbwBMMdZAn5QKqYMgfdGs3qL6bWNtPWasXfmOe93Ix13N1CStv9Fos7qn6GYOBVHPJEItcv1LFQdIcND9j9dGZqEZaI0YxRuT31ZhsNKA2KhNEZMm2M/aPRbTcfralJNS7lshPkvTwhyeHSPAYS1tcNqxtmahtYdqeL9w1Pu9FUi3l6sOEZsL0PrgsIVd6My0kfLj+F5cmVmulWMxB2ukcZMUAPYaioyZuZ9dyg3YddHX/iihhCsjEtBOLrjzZaSOX98BibcQWkIn/GiW3B9sAhwpdqtFQJ8VaYfjf6E5e+hGTy4XnjMEQd3JWyNwvhoWHDkTjhovUQJ1kPjMIgN3KTwKv5e4=
  - secure: cjYBi8Wy8nxziKe+IZNvWbVR50k8pciDGlAMHaNUaZEN3FMG3PxcpUQ7e/p4+jzBDMxSPN72Yuj9zGrNVe7/Pt6dJ9u6AxdFH9PdB/3AZ+D55zkudG89NLpfeWkr1Or45m8tSoxiwQO2VQAtYwUGKr4U0//t08I4OICGT8XyQ45JhSwok/CnpKC0RLZzsjKu3Du/OO42OPlHEIx1AJQ7tsQqmbrGruyDjpxDDAtjmr1Vm+KpFAWuq2twrQN8tJQ6c8THOYMN2BL7kiI8fZIWzQTWpGLmTMvigXlSXlsdtNCU0jKA1RgdoRF89LrOYDtkqR3UzjVemuY793g70kCR7YmelfQkltMM2vFg2g6to+BsIFZK+zLr+RTC3cnSoBEEjUpjPqxXPVvL+1Cmpt+dJO9wEsxpNLiInL6yLrNHeStt8bsrKluGUWF8Ozk+N+ApTo05t0toj6Q388xDYRgu0UsLej0hO2Ue3P2PsviTC36ITyXiy0uUyLDiHfcss/uaLK0u0QDylENhIihmM43HmrY8ewpwWpuxGcLGRi7eeGn6HHPkMYn1oI6cUpdLgUHxnMVlgmF2dwUaWImUZSLKdnPmG+4XtgFWtdIYyNlak5MCSz/96oxlRP0gMue7jxkO67DqK8myR7QD2ChDttV1sUfvsbmn2R8Q6JVCoACnsoQ=
before_install:
- mysql -u root < create_tables.sql
- AUTH_TOKEN_VALUE=$(echo $AUTH_TOKEN | sed 's/AUTH_TOKEN=//')
- REFRESH_TOKEN_VALUE=$(echo $REFRESH_TOKEN | sed 's/REFRESH_TOKEN=//')
- query="use playlists; insert into users (username, email, spotify_auth_token, spotify_refresh_token,
  is_spotify_user, spotify_time_of_last_track_played, expires_at) VALUES ('test_user',
  'test_user@test.com', '$AUTH_TOKEN_VALUE', '$REFRESH_TOKEN_VALUE', '1', '-1', '-1');"
- mysql -u root -e "$query"
# DB_* variables are not secret, but travis seems to not allow modifying a file
# that contains secrets. I had tried `echo 'DB_HOST=127.0.0.1' > .env` but nothing happened.
# DB_HOST=127.0.0.1, DB_USER=root, DB_PASS='', DB_NAME=playlists
- DB_HOST=127.0.0.1
- DB_USER=root
- DB_PASS=''
- DB_NAME=playlists
- echo $SPOTIFY_CLIENT_ID > .env
- echo $SPOTIFY_CLIENT_SECRET > .env
install:
- pip install -r requirements.txt
script: pytest -v -s
